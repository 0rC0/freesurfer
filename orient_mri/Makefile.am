AM_CFLAGS=-I$(top_srcdir)/include \
	$(VTK_CFLAGS) $(KWWIDGETS_CFLAGS) $(TCL_CFLAGS)
AM_CXXFLAGS=-Wno-deprecated -I$(top_srcdir)/include \
	$(VTK_CXXFLAGS) $(KWWIDGETS_CXXFLAGS) $(TCL_CFLAGS)

if ENABLE_KWWIDGETS_APPS
bin_PROGRAMS = orient_mri
orient_mri_SOURCES= \
	OrientMRIMain.cxx \
	vtkKWOrientMRIApp.cxx vtkKWOrientMRIApp.h vtkKWOrientMRIAppTcl.cxx \
	vtkKWOrientMRIWindow.cxx vtkKWOrientMRIWindow.h vtkKWOrientMRIWindowTcl.cxx \
	vtkKWOrientMRIView.cxx vtkKWOrientMRIView.h vtkKWOrientMRIViewTcl.cxx \
	vtkFSVolumeSource.cxx vtkFSVolumeSource.h \
	OrientMRICustomIcons.cxx OrientMRICustomIcons.h \
	OrientMRILibInit.cxx
orient_mri_LDADD= $(addprefix $(top_srcdir)/, $(LIBS_MGH)) $(LIBS_TCL_OPENGL) \
	$(VTK_LIBS) -lvtkWidgets -lvtkGraphics -lvtkImaging -lvtkFiltering \
	-lvtkCommon -lvtksys \
	-lvtkHybrid -lvtkexoIIc -lvtkNetCDF \
	-lvtkVolumeRendering -lvtkRendering -lvtkftgl \
	-lvtkfreetype -lvtkIO \
	-lvtkDICOMParser -lvtkzlib -lvtkpng \
	-lvtkjpeg -lvtkexpat -lvtkMPEG2Encode -lvtktiff \
	-lvtkImagingTCL -lvtkVolumeRenderingTCL -lvtkRenderingTCL \
	-lvtkFilteringTCL -lvtkWidgetsTCL \
	-lvtkHybridTCL -lvtkGraphicsTCL -lvtkImagingTCL -lvtkIOTCL \
	-lvtkCommonTCL \
	$(KWWIDGETS_LIBS) -lKWWidgets
orient_mri_LDFLAGS=$(OS_LDFLAGS) $(LDFLAGS_TCL)

vtkKWOrientMRIAppTcl.cxx: vtkKWOrientMRIApp.h
	${VTK_DIR}/bin/vtkWrapTcl vtkKWOrientMRIApp.h \
	${VTK_DIR}/src/VTK/Wrapping/hints 1 vtkKWOrientMRIAppTcl.cxx

vtkKWOrientMRIWindowTcl.cxx: vtkKWOrientMRIWindow.h
	${VTK_DIR}/bin/vtkWrapTcl vtkKWOrientMRIWindow.h \
	${VTK_DIR}/src/VTK/Wrapping/hints 1 vtkKWOrientMRIWindowTcl.cxx

vtkKWOrientMRIViewTcl.cxx: vtkKWOrientMRIView.h
	${VTK_DIR}/bin/vtkWrapTcl vtkKWOrientMRIView.h \
	${VTK_DIR}/src/VTK/Wrapping/hints 1 vtkKWOrientMRIViewTcl.cxx

OrientMRILibInit.cxx: OrientMRILibInit.data
	${VTK_DIR}/bin/vtkWrapTclInit OrientMRILibInit.data OrientMRILibInit.cxx

# put a wrapper around the bin, used to setup tcltktixblt,vtk,kww enviro vars
install-exec-hook:orient_mri
	mv $(srcdir)/orient_mri $(DESTDIR)$(bindir)/orient_mri.bin
	echo "#!/bin/tcsh -ef" > $(DESTDIR)$(bindir)/orient_mri
	echo "source \$$FREESURFER_HOME/bin/tcl_setup" \
		>> $(DESTDIR)$(bindir)/orient_mri
	echo "source \$$FREESURFER_HOME/bin/vtk_setup" \
		>> $(DESTDIR)$(bindir)/orient_mri
	echo "source \$$FREESURFER_HOME/bin/kww_setup" \
		>> $(DESTDIR)$(bindir)/orient_mri
	echo "orient_mri.bin \$$argv" >> $(DESTDIR)$(bindir)/orient_mri
	chmod a+x $(DESTDIR)$(bindir)/orient_mri

else
bin_PROGRAMS = 

all:
	@echo "Building KWWidgets apps not enabled."
	@echo "Run configure with either --enable-kww-apps or --with-kwwidgets-dir=DIR"

install-exec-hook:

# these are created on-th-fly (see above), but make dist complains if they
# don't exist, so create some empty files for packaging purposes:
dist-exec-hook:
	@touch vtkKWOrientMRIAppTcl.cxx
	@touch vtkKWOrientMRIWindowTcl.cxx
	@touch vtkKWOrientMRIViewTcl.cxx
	@touch OrientMRILibInit.cxx
	@sleep 2
	@touch vtkKWOrientMRIApp.h
	@touch vtkKWOrientMRIWindow.h
	@touch vtkKWOrientMRIView.h
	@touch OrientMRILibInit.data

vtkKWOrientMRIAppTcl.cxx:
vtkKWOrientMRIWindowTcl.cxx:
vtkKWOrientMRIViewTcl.cxx:
OrientMRILibInit.cxx:
endif

EXTRA_DIST=$(wildcard *.h) $(wildcard *.cxx) $(wildcard *.data)

# Our release target. Include files to be excluded here. They will be
# found and removed after 'make install' is run during the 'make
# release' target.
EXCLUDE_FILES=
include $(top_srcdir)/Makefile.extra
